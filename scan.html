<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XSS Scanner - Scan Your Code</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .scanner-card {
            background: rgba(45, 55, 72, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .input-area {
            background: rgba(26, 32, 44, 0.8);
            border: 2px solid #4a5568;
            border-radius: 8px;
            color: #e2e8f0;
            font-family: monospace;
            resize: vertical;
        }
        .input-area:focus {
            border-color: #63b3ed;
            box-shadow: 0 0 0 3px rgba(99, 179, 237, 0.1);
        }
        .btn-scan {
            background: linear-gradient(135deg, #3182ce 0%, #2c5282 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-scan:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(49, 130, 206, 0.3);
        }
        .btn-scan:active {
            transform: translateY(0);
        }
        .results-area {
            background: rgba(26, 32, 44, 0.8);
            border-radius: 8px;
            border: 1px solid #4a5568;
            color: #e2e8f0;
            font-family: monospace;
        }
        .vulnerable {
            color: #fc8181;
        }
        .safe {
            color: #68d391;
        }
        .navbar {
            background: rgba(26, 32, 44, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }
        .shape {
            position: absolute;
            border-radius: 50%;
            background: rgba(99, 179, 237, 0.1);
            animation: float 8s ease-in-out infinite;
        }
        .shape:nth-child(1) {
            width: 60px;
            height: 60px;
            top: 15%;
            left: 15%;
            animation-delay: 0s;
        }
        .shape:nth-child(2) {
            width: 40px;
            height: 40px;
            top: 25%;
            right: 15%;
            animation-delay: 3s;
        }
        .shape:nth-child(3) {
            width: 80px;
            height: 80px;
            bottom: 15%;
            left: 25%;
            animation-delay: 6s;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
        }
    </style>
</head>
<body>
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>
    <nav class="navbar p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold text-white">XSS Scanner</h1>
            <div class="flex items-center space-x-4">
                <span class="text-gray-300">Welcome, User</span>
                <button onclick="logout()" class="text-blue-400 hover:text-blue-300">Logout</button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-8">
        <div class="scanner-card p-8 max-w-4xl mx-auto">
            <h2 class="text-3xl font-bold text-white mb-6 text-center">XSS Vulnerability Scanner</h2>
            <p class="text-gray-300 mb-6 text-center">Paste your HTML/JavaScript code below to scan for XSS vulnerabilities</p>

            <div class="mb-6">
                <label for="code-input" class="block text-white font-semibold mb-2">Code to Scan:</label>
                <textarea id="code-input" class="input-area w-full p-4 text-sm" rows="10" placeholder="Enter your code here..."></textarea>
            </div>

            <div class="text-center mb-6">
                <button onclick="scanCode()" class="btn-scan px-8 py-3 text-lg">
                    <i class="fas fa-search mr-2"></i>Scan for XSS
                </button>
            </div>

            <div id="results-section" class="results-area p-4" style="display: none;">
                <h3 class="text-xl font-bold text-white mb-4">Scan Results:</h3>
                <div id="results-content"></div>
            </div>
        </div>
    </div>

    <script>
        // Check if user has API key
        if (!localStorage.getItem('xssApiKey')) {
            window.location.href = 'login.html';
        }

        function logout() {
            localStorage.removeItem('loggedIn');
            window.location.href = 'index.html';
        }

        async function scanCode() {
            const code = document.getElementById('code-input').value;
            const resultsSection = document.getElementById('results-section');
            const resultsContent = document.getElementById('results-content');
            const scanBtn = document.getElementById('scan-btn');

            if (!code.trim()) {
                alert('Please enter some code to scan.');
                return;
            }

            const apiKey = localStorage.getItem('xssApiKey');
            if (!apiKey) {
                alert('Please log in to use the scanner.');
                window.location.href = 'login.html';
                return;
            }

            // Show loading state
            resultsSection.style.display = 'block';
            resultsContent.innerHTML = '<div class="text-blue-400"><i class="fas fa-spinner fa-spin mr-2"></i>Scanning your code...</div>';
            scanBtn.disabled = true;
            scanBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Scanning...';

            try {
                const response = await fetch('/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': apiKey
                    },
                    body: JSON.stringify({ code })
                });

                const result = await response.json();

                if (response.ok) {
                    resultsContent.innerHTML = '';
                    if (result.vulnerabilities_found > 0) {
                        resultsContent.innerHTML = `<div class="vulnerable text-red-400 mb-4"><i class="fas fa-exclamation-triangle mr-2"></i>Found ${result.vulnerabilities_found} potential XSS vulnerabilities:</div>`;
                        result.vulnerabilities.forEach(vuln => {
                            resultsContent.innerHTML += `
                                <div class="vulnerable mb-2 p-3 border border-red-500 rounded bg-red-50">
                                    <div class="font-semibold text-red-700 mb-1">${vuln.vulnerability_type}</div>
                                    <div class="text-sm text-gray-600 mb-1">Line ${vuln.line}: ${vuln.description}</div>
                                    <div class="text-xs text-gray-500">Snippet: <code class="bg-gray-100 px-1 rounded">${escapeHtml(vuln.snippet)}</code></div>
                                </div>
                            `;
                        });
                        resultsContent.innerHTML += '<div class="text-yellow-600 mt-4 p-2 bg-yellow-50 rounded"><i class="fas fa-info-circle mr-2"></i>Note: This scan uses heuristic patterns. Always perform manual code review for critical applications.</div>';
                    } else {
                        resultsContent.innerHTML = '<div class="safe text-green-400 p-3 bg-green-50 rounded"><i class="fas fa-check-circle mr-2"></i>No XSS vulnerabilities detected in the provided code.</div>';
                    }
                } else {
                    resultsContent.innerHTML = `<div class="text-red-400"><i class="fas fa-exclamation-circle mr-2"></i>Error: ${result.detail || 'Scan failed'}</div>`;
                }
            } catch (error) {
                resultsContent.innerHTML = '<div class="text-red-400"><i class="fas fa-exclamation-circle mr-2"></i>Error: Unable to connect to the API. Please try again later.</div>';
                console.error('Scan error:', error);
            } finally {
                scanBtn.disabled = false;
                scanBtn.innerHTML = '<i class="fas fa-search mr-2"></i>Scan for XSS';
            }
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '<',
                '>': '>',
                '"': '"',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }
    </script>
</body>
</html>
